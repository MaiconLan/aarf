<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:p="http://primefaces.org/ui"
	  xmlns:a="http://xmlns.jcp.org/jsf/core">

<ui:composition template="/template/layout.xhtml">
	<ui:define name="conteudo">

		<h:form id="permissao" styleClass="cadastro-permissao">
			<p:growl id="messages" showDetail="true" autoUpdate="true" />

			<center>
				<h3>Vincular Regra ao Perfil</h3>
			</center>

			<h:panelGrid id="panelBuscaPerfil" columns="2">
				<p:commandButton icon="fa fa-fw fas fa-search"
								 styleClass="btn-block btn-info btn-flat"
								 title="Pesquisa"
								 action="#{regraWebBean.abrirModalPerfil}"
								 process="@this"
								 update="@none">
					<p:ajax event="dialogReturn"
							listener="#{regraWebBean.perfilSelecionadoEvent}" process="@this"
							update="panelBuscaPerfil panelRegras" />
				</p:commandButton>

				<p:inputText value="#{regraWebBean.perfilSelecionado.idPerfil}"
							 id="idPerfil" />

				<p:outputLabel value="Perfil: " for="nomePerfil" />
				<p:outputLabel value="#{regraWebBean.perfilSelecionado.nome}"
							   id="nomePerfil" />

				<p:outputLabel value="Descrição: " for="descricaoPerfil" />
				<p:outputLabel value="#{regraWebBean.perfilSelecionado.descricao}"
							   id="descricaoPerfil" />
			</h:panelGrid>
			<br />

			<p:panelGrid id="panelRegras" columns="1">
				<p:selectOneMenu filter="true" filterMatchMode="contains"
								 value="#{regraWebBean.regraSelecionada}" immediate="true"
								 converter="omnifaces.SelectItemsConverter">
					<f:selectItem itemLabel="Selecione" />
					<f:selectItems value="#{regraWebBean.regras}" var="regra"
								   itemLabel="#{regra.nome}" itemValue="#{regra}" />
					<p:ajax process="@this" />
				</p:selectOneMenu>

				<p:commandButton id="adicionarRegra"
								 value="Adicionar"
								 styleClass="btn-block btn-teal btn-flat"
								 update="regras panelRegras"
								 process="@this"
								 action="#{regraWebBean.novaRegraSelecionada()}">
					<p:collector value="#{regraWebBean.regraSelecionada}"
								 addTo="#{regraWebBean.perfilSelecionado.regras}" unique="true" />
				</p:commandButton>

				<p:dataTable value="#{regraWebBean.perfilSelecionado.regras}"
							 var="regra" id="regras">

					<p:column headerText="Nome">
						<h:outputText value="#{regra.nome}" />
					</p:column>

					<p:column headerText="Descrição">
						<h:outputText value="#{regra.descricao}" />
					</p:column>

					<p:column headerText="Ação" width="80">
						<p:commandLink value="Remover" update="regras" process="regras">
							<p:collector value="#{regra}"
										 removeFrom="#{regraWebBean.perfilSelecionado.regras}"
										 unique="true" />
						</p:commandLink>
					</p:column>

				</p:dataTable>
			</p:panelGrid>
			<br />

			<h:panelGrid id="acoes" columns="3"  >
				<p:commandButton value="Salvar" icon="fa fa-fw fa-edit"
								 id="salvar"
								 styleClass="btn-block btn-success btn-flat"
								 actionListener="#{regraWebBean.salvarPerfil()}"
								 process="permissao"
								 update="permissao" />
				<p:spacer height="10"/>
				<p:commandButton value="Limpar" icon="fa fa-fw fa-refresh"
								 id="limpar"
								 styleClass="btn-block btn-warning btn-flat"
								 actionListener="#{regraWebBean.initialize()}"
								 update="permissao" />
			</h:panelGrid>
		</h:form>
	</ui:define>
</ui:composition>
</html>